{% load static %}
{% load custom_filters %}
{% load humanize %}
<!DOCTYPE html>
<br lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social E-commerce Timeline</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}"> <!-- Link to your CSS file -->
     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-
2811308505659881" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/34a56207d1.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6931205265043049"
     crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
        }
        header {
            background-color: lightseagreen;
            padding: 10px;
            position: fixed;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header input {
            padding: 5px;
            border-radius: 5px;
            border: none;
        }
        header button {
            padding: 5px 10px;
            border-radius: 5px;
            background-color: white;
            color: lightseagreen;
            border: none;
        }
        header .hamburger {
            cursor: pointer;
            color: white;
            width: 20px;
        }
        #menu {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            right: 10px;
            top: 50px;
            z-index: 999;
            width: 150px;
        }
        #menu ul {
            margin-top: 60px;
            list-style: none;
            padding: 0;
        }
        #menu ul li {
            padding: 10px;
            text-align: center;
        }
        #menu ul li:hover {
            background-color: lightseagreen;
            color: white;
        }
        .container {
            display: flex;
            justify-content: space-between;
            padding: 20px;
        }
        .left, .right {
            width: 20%;
        }
        .middle {
            width: 60%;
            margin: 0 10px; /* Small margin between sections */
            overflow-y: auto; /* Allow scrolling */
            max-height: 100%; /* Adjust max-height based on header */
        }
        /* Stories Section */
        .stories {
            display: flex;
            overflow-x: auto;
            margin-bottom: 30px;
            margin-top: 30px;
            padding: 10px 0;
            gap: 20px;
        }
        .story {
            width: 120px;
            height: 180px;
            border-radius: 10px;
            margin-right: 10px;
            background-color: #f4f4f4;
            position: relative;
            color: black;
            flex-shrink: 0;
            cursor: pointer;
        }
        .story img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
        }
        .story-username {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-size: 2em;
            cursor: pointer;
        }
        .story-username p a {
            color: white;
            text-decoration: none;
            padding: 5px;
            font-size: 15px;
            background: ;
            border-radius: 10px;
        }
        /* Products Section */

<style>
    .product-container {
        padding: 20px;
        background-color: #f9f9f9;
        max-width: 100%;
        overflow-x: auto;
    }

    .product-scroll {
        display: flex;
        gap: 15px;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        padding-bottom: 10px;
    }

    .product-card {
        flex: 0 0 auto;
        scroll-snap-align: start;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 15px;
        text-align: center;
        width: 200px;
    }

    .product-card img {
        max-width: 100%;
        border-radius: 8px;
        margin-bottom: 10px;
    }

    .product-card h3 {
        font-size: 1.1rem;
        color: #333;
        margin: 10px 0 5px;
    }

    .product-card p {
        font-size: 1rem;
        color: #555;
        margin: 5px 0 15px;
    }

    .buy-now-btn {
        display: inline-block;
        background-color: lightseagreen;
        color: white;
        font-size: 1rem;
        padding: 8px 12px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: bold;
    }

    .buy-now-btn:hover {
        background-color: #0d8166;
    }

    /* Horizontal Scroll Styling */
    .product-scroll::-webkit-scrollbar {
        height: 8px;
    }

    .product-scroll::-webkit-scrollbar-thumb {
        background-color: lightseagreen;
        border-radius: 10px;
    }

    .product-scroll::-webkit-scrollbar-track {
        background-color: #f1f1f1;
    }

        /* Post Section */
        .posting {
            display: flex;
            align-items: center;
            gap: 20px;
            border-bottom: 2px solid lightseagreen;
            padding-bottom: 25px;
            border_radius: 10px;
        }
         .posting img {
           width: 40px;
           height: 40px;
           border-radius: 50%;
         }
        .posting input {
            width: 100%;
            border-radius: 10px;
            height: 30px;
            border: white;
            padding-left: 8px;
            box-shadow: 1px 0.5px 1px 0.5px rgba(0, 0, 0, 0.2);
        }
        .ad {
           background: lightseagreen;
           padding: 5px;
           color: white;
           border-radius: 5px;
           text-decoration: none;

        }
        .list-p-s {
           margin-bottom: 10px;
           padding: 20px 5px;
           border-bottom: 2px solid lightseagreen;
           border-top: 2px solid lightseagreen;
        }
        .posts {
            margin-top: 30px;
        }
        .post {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
        }
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .post-header img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .post-content img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 10px;
        }
        .post-content h2 {
           color: lightseagreen;
           }
         .icon {
            color: lightseagreen;
            font-size: 24px;
            margin-right: 5px;
            margin-left: 15px;
            cursor: pointer;
        }
        .icon.liked {
            color: red;
        }
        .icon-container {
            display: flex;
            align-items: center;
            margin-top: 20px;
            }
         #toggle-comment-form {
            font-size: 24px;
            margin-bottom: 10px;
            }
          #comments-list{
            display: none; /* Form hidden initially */
            }
         .comment {
            border-bottom: 1px solid #ddd;
            padding: 5px 0;
            }
         .star-rating {
           color: gold;  /* Makes the stars yellow */
           font-size: 20px;  /* Adjust the size as needed */
            }
         .list-p-s button {
           padding: 10px 5px 10px;
           border-radius: 10px;
           background: lightseagreen;
           border: none;
           color: white;
         }

        /* Fullscreen Story */
        #full-screen-story {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        #full-screen-story img {
            width: 80%;
            height: 60%;
            border-radius: 10px;
        }
        .story-username {
           position: absolute;
           bottom: 20px;
           left: 20px;
           color: white;
           font-size: 1.1em;
           cursor: pointer;

        }
        ul a {
          text-decoration: none;
        }
        /* Mobile Specific */
        @media (max-width: 768px) {
        .post {
            border-top: 1px solid lightseagreen;
            padding: none;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid lightgrey;
            border-radius: 10px;
        }
            .container {
                flex-direction: column;
            }
            .left, .right {
                display: none;
            }
            .middle {
                width: 100%;
                height: 100%;
            }
            .stories {
                gap: 10px;
            }
            .story {
            width: 120px;
            height: 100%;
            flex-shrink: 0;

            }
            .advert {
                display: block;

                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 10px;
                text-align: center;
                height: 350px;
                background-color: lightseagreen;
                color: white;
                margin-bottom: 30px;
            }


            .advert img {

            height: 200px;
            }
        }
  .video-scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 10px;
            white-space: nowrap;
            scroll-snap-type: x mandatory;
        }

        .video-card {
            position: relative;
            cursor: pointer;
            width: 160px;
            height: 240px;
            scroll-snap-align: start;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .video-card video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .video-title {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            color: #fff;
            text-align: center;
            font-size: 12px;
            padding: 5px 0;
        }

        #video-modal {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

       .video-modal video {
           width: 350px; /* Fixed width for all videos */
           height: 500px; /* Fixed height for all videos */
           object-fit: cover; /* Ensures the video fills the defined dimensions */
           border-radius: 10px;
           background-color: black; /* Fills any gaps if the video doesn't load immediately */
   }


        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: white;
            cursor: pointer;
        }

        .video-info {
            margin-top: 10px;
            text-align: center;
        }

       .video-controls {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-top: 10px;
    color: white;
    font-size: 18px;
}

.video-controls .control {
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
}

.video-controls .control i {
    font-size: 20px;
}

.video-controls .liked i {
    color: lightseagreen;
}

.comment-section {
    margin-top: 15px;
    max-height: 200px;
    overflow-y: auto;
    border-top: 1px solid #555;
    padding: 10px;
    color: white;

}

#commentForm {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

#commentForm textarea {
    flex: 1;
    padding: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
}

#commentForm button {
    padding: 5px 10px;
    border-radius: 5px;
    background-color: lightseagreen;
    color: white;
    border: none;
    cursor: pointer;
}

.whatsapp-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #25D366;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1000;
            text-decoration: none; /* Remove underline for the link */
        }

        .whatsapp-button:hover {
            background-color: #1EBE5B;
        }

        .whatsapp-button img {
            width: 30px;
            height: 30px;
        }
    </style>
</head>
<header>
<div class="logo-and-nav">
    <h1 class="logo">      <a style=" text-decoration: none; color: white;" href="{% url 'home' %}">MariCho</a></h1>
      
<nav class="nav-links">
    <a href="{% url 'news' %}" class="nav-item">
        <i class="fas fa-newspaper"></i>
        <span>News</span>
    </a>
    
    <a href="{% url 'property-list' %}" class="nav-item">
        <i class="fas fa-home"></i>
        <span>Property</span>
    </a>
    
    <a href="{% url 'job-land' %}" class="nav-item">
        <i class="fas fa-briefcase"></i>
        <span>Jobs</span>
    </a>
    
    <a href="{% url 'business' %}" class="nav-item">
        <i class="fas fa-cogs"></i>
        <span>Services</span>
    </a>
          
</nav>

<style>
    .nav-links {
        display: flex;
        gap: 2rem;
        justify-content: center;
        align-items: center;
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: white;
        gap: 0.5rem;
        transition: all 0.3s ease;
        padding: 0.5rem;
    }

    .nav-item i {
        font-size: 24px;
    }

    .nav-item span {
        font-size: 0.9rem;
        white-space: nowrap;
    }

    .nav-item:hover {
        transform: translateY(-2px);
        opacity: 0.9;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .nav-links {
            gap: 1rem;
        }
        
        .nav-item i {
            font-size: 20px;
        }
        
        .nav-item span {
            font-size: 0.8rem;
        }
    }
</style>
  </div>
    <div class="search-container">
        <form method="get" action="{% url 'category' %}">
            <input type="text" list="categorylist" name="query" value="{{ query }}" placeholder="Search item">
            <datalist id="categorylist">
                {% for category in categories %}
                <option value="{{ category.name }}"></option>
                {% endfor %}
                {% for pair in post_ad_pairs %}
                <option value="{{ pair.post.user }}"></option>
                <option value="{{ pair.post.caption }}"></option>
                {% endfor %}
            </datalist>
            <button>Search</button>
        </form>
        <div class="hamburger" onclick="toggleMenu()">☰</div>
    </div>
</header>

<div id="menu" class="hidden">
    <ul style="margin-top: 150px">
        {% if user.is_authenticated %}
        <li> <a href="{% url 'logout' %}">Logout</a> </li>
        {% else %}
       <li> <a href="{% url 'signin' %}">Login</a> </li>
        {% endif %}
    </ul>
</div>

<style>
    header {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 20px;
        background-color: lightseagreen; /* Theme color */
        position: relative;
    }

/* Logo and Navigation Links */
.logo-and-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}

.logo {
  font-size: 1.5rem;
  font-weight: bold;
  color: white;
  margin-right: 20px;
}

.nav-links {
  margin-top: 10px;
  display: flex;
  gap: 15px;
}

.nav-links a {
  text-decoration: none;
  color: white;
  font-size: 1rem;
}
  .search-container {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 600px;
    }

    form {
        display: flex;
        flex-grow: 1;
        margin-right: 10px;
    }

    input {
        flex-grow: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px 0 0 5px;
        background-color: white;
        color: black;
        width: 200px;
    }

    button {
        background-color: white;
        color: lightseagreen;
        border: 1px solid lightseagreen;
        padding: 8px 15px;
        border-radius: 0 5px 5px 0;
        cursor: pointer;
    }
      </style>
</div>

<div class="container">

    <div class="left">
        <style>
          .jobs a {
             background: lightseagreen;
             color: white;
             padding: 10px;
             display: flex;
             margin-bottom: 10px;k
             border-radius: 5px;
             text-decoration: none;
            }
        </style>
        <h2>Jobs</h2>
        <div class="jobs">
        {% for job in jobs %}
            <a href="{% url 'job-land' %}">{{ job.title }}</a>
        {% endfor %}
        </div>
        <!-- Job Listings Here -->
    </div>

    <div class="middle">
        <div class="posting">
{% if user.is_authenticated %}
 {% for c_u_p in c_u_ps %}
    {% if c_u_p.user == request.user %}
    <a href="{% url 'profile' c_u_p.id %}"> <img src="{{ c_u_p.profileimg.url }}"> </a>

    {% endif %}
    {% endfor %}
{% else %}
    <a href="{% url 'signin' %}">Login to view</a>
    {% endif %}
    <a href="{% url 'post' %}"><input placeholder="What's Selling Today??"></a>
    <a class="ad" href="{% url 'post' %}"> + PostAd</a>

        </div>
        <!-- Stories Section -->
        <div class="stories">
            {% for story in products %}
              
            <div class="story" onclick="openFullScreen('{{ story.story_img.url }}')">
                <img src="{{ story.story_img.url }}" alt="{{ story.description }}">
                <div id="story-username" class="story-username">
                      {% if story.user.profile %}
               <a style="text-decoration: none; color: white;" href="{% url 'profile' story.user.profile.id %}"> <p>{{ story.user.username }}</p> </a> 
                {% else %}
                      <p> no user profile </p>
                      {% endif %}
                </div>
            </div>
            <!-- Fullscreen Story View -->
<div id="full-screen-story" onclick="closeFullScreen()">
    <img id="full-story-image" src="">
</div>

            {% endfor %}
        </div>

          <div>
  <style>
    .add-product-btn {
      background-color: lightseagreen;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .add-product-btn:hover {
      background-color: #209b9b;
      transform: scale(1.05);
    }

    .add-product-btn:active {
      background-color: #1a7a7a;
      transform: scale(0.95);
    }
  </style>
</head>

  <a href="{% url 'product' %}"> <button class="add-product-btn">Add Product</button> </a>
</div>

          
        <!-- Products Section -->
        <div class="product-container">
    <h2 style="color: lightseagreen;">Our Products</h2>
    <div class="product-scroll">
        {% for product in products %}
        <div class="product-card">
            <img src="{{ product.product_img.url }}" alt="{{ product.description }">
            <h3>{{ product.product_name }}</h3>
            <p>${{ product.price }}</p>
            <a href="/flane/product-details/{{product.id}}/{{product.product_name}}" class="buy-now-btn">Buy Now</a>
        </div>
        {% endfor %}
    </div>
</div>
        <!-- Video Gallery (Horizontally Scrollable) -->
        <h2 style="color: lightseagreen;">Winks</h2>
<div class="video-gallery" style="display: flex; overflow-x: auto; gap: 10px; padding: 10px;">

    {% for video in videos %}
    <div class="video-card" data-video-id="{{ video.id }}" style="position: relative; width: 300px; height: 200px; flex-shrink: 0; cursor: pointer; overflow: hidden; border-radius: 5px;">
        <video loop autoplay muted playsinline style="width: 100%; height: 100%; object-fit: cover;">
            <source src="{{ video.video_file.url }}" type="video/mp4">
        </video>
        <div style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.5); color: white; text-align: center; padding: 5px; font-size: 16px;">
            {{ video.title }}
        </div>
    </div>
    {% endfor %}
</div>


<!-- Video Modal -->
<div id="video-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); color: white; overflow: hidden; padding: 20px;">
    <button id="close-modal" style="position: absolute; top: 20px; right: 20px; font-size: 24px; color: white; background: none; border: none; cursor: pointer;">X</button>

    <!-- Scroll Hint -->
    <div id="scroll-hint" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.7); color: white; padding: 10px 20px; border-radius: 5px; display: none; z-index: 1000;">
        Scroll left or right to view more videos.
    </div>

    <!-- Video Container -->
    <div id="video-container" style="display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 10px; height: 100%; align-items: center;">
        {% for video in videos %}
        <div class="video-card" data-video-id="{{ video.id }}" style="flex: 0 0 100%; scroll-snap-align: start; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <video controls loop autoplay muted style="width: 100%; height: 80%; object-fit: cover;">
                <source src="{{ video.video_file.url }}" type="video/mp4">
            </video>
            <div class="modal-icons" style="position: absolute; bottom: 20%; right: 10%; display: flex; flex-direction: column; gap: 10px; align-items: center;">
                <i class="fa fa-heart" style="color: white; font-size: 24px; cursor: pointer;"></i>
                <span>0</span>
                <i class="fa fa-comment" style="color: white; font-size: 24px; cursor: pointer;"></i>
                <span>0</span>
            </div>
            <div id="comments-section" style="margin-top: 20px; max-height: 300px; overflow-y: auto; width: 100%; padding: 10px;">
                <div id="comments-list" style="margin-bottom: 20px;">
                    <!-- Comments will be appended here dynamically -->
                </div>
                <form id="comment-form" style="display: flex; gap: 10px;">
                    <textarea placeholder="Add a comment..." style="flex: 1; padding: 10px; border-radius: 5px;"></textarea>
                    <button type="submit" style="padding: 10px; background: #0066ff; color: white; border: none; border-radius: 5px;">Post</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>


    <!-- Hidden video ID field -->
    <input type="hidden" id="modal-video-id" value="" />
        
        <!-- Posts Section -->
        <div id="posts-container">
        <div id="raw-posts" class="posts">
            {% for pair in post_ad_pairs  %}

           {% for profile in profiles %}
          {% if pair.post.user == profile.user %}
            <div class="post" data-post-id="post-{{ pair.post.id }}">
                <div class="post-header">
                    <a href="{% url 'profile' profile.id %}">
                        <img src="{{ profile.profileimg.url }}" alt="{{ pair.post.user }}"></a>
                    <div>
                        <h3>{{ pair.post.user }}</h3>
                    </div>
                </div>
                  <div>
                        <p style="color: lightseagreen; ">{{ profile.followers }} Follower{{ profile.followers|pluralize}}</p>
                        <p> {{ pair.post.user.profile.bio|truncatewords:7}}</p>
                      </div>
                <div class="post-content">
                    <p>{{pair.post.created_at|naturaltime}}</p>
                      {% if pair.post.image and pair.post.image.url %}
                    <img src="{{ pair.post.image.url }}" alt="{{pair.post.caption}}">
                      {% else %}
                      <p>image missing</p>
                      {% endif %}
                    <h2>{{ pair.post.title }}</h2>
                    <p>{{ pair.post.caption }}</p>
                </div>
 <div class="icon-container">
        <!-- Like Button -->
        <i class="fas fa-thumbs-up icon {% if pair.post.liked %}liked{% endif %}"
           id="like-icon-{{ pair.post.id }}"
           title="Like"
           data-post-id="{{ pair.post.id }}"></i>
        <span id="like-count-{{ pair.post.id }}">{{ pair.post.no_of_likes }}</span>
        <!-- Comment Icon -->

        <!-- Toggle comment form -->
         <i id="toggle-comment-form-{{ pair.post.id }}" class="fas fa-comment-dots"
       style="color: lightseagreen; cursor: pointer; font-size: 24px; margin-left: 10px; margin-right: 5px;"></i> {{ pair.post.comments.count }}
        <!-- WhatsApp Share Icon -->
        <a href="https://wa.me/{{profile.phone_number}}?text=Hello I'm interested in your product {{pair.post.caption}} for sale on www.maricho.online/flane/home" target="_blank">
            <i class="fab fa-whatsapp icon" title="Share on WhatsApp"></i>
        </a>
      </div>
    <!-- Comments list (initially hidden) -->

    <div id="comments-list-{{ pair.post.id }}" style="display: none;">
        <!-- Comments will load here via AJAX -->
    </div>

    <!-- Comment Form (initially hidden, positioned below comments list) -->
    <form class="comment-form" id="comment-form-{{ pair.post.id }}" style="display: none;" data-post-id="{{ pair.post.id }}" method="post">
        {% csrf_token %}
        {{ comment_forms.as_p }}
        <button style="background: lightseagreen; color: white; border-radius: 10px;
        border: none; padding: 4px;" type="submit" class="btn-submit">Submit</button>

    </form>
                <style>
                    comment-form input,
                    .comment-form textarea {
                       width: 80%;  /* Adjust the width percentage as needed */
                       }

                </style>


            </div>

    {% if pair.ad %}


    <style>

        .ad-container {
            margin: 20px auto;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            transition: transform 0.2s, box-shadow 0.2s;
            opacity: 0;
            transform: translateY(20px);
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
            padding-bottom: 60px;
        }
        .ad-container.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .ad-image {
            width: 100%; /* Responsive image */
            height: auto;
            border-radius: 5px;
            transition: transform 0.3s; /* Image hover effect */
        }
        .ad-image:hover {
            transform: scale(1.05); /* Zoom effect on hover */
        }
        .ad-title {
            font-size: 1.5em;
            margin: 0;
            color: lightseagreen; /* Light sea green color */
        }
        .ad-description {
            text-align: left;
            margin: 10px 0;
            color: #555;
            font-size: 0.9em;
            margin-left: 5px;
        }
        .ad-date {
            font-size: 0.9em;
            color: #999;
        }
        .ad-button {
            padding: 10px 15px;
            background-color: lightseagreen; /* Light sea green */
            color: white;
            text-decoration: none;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            display: inline-block;
            transition: background-color 0.3s;
            position: absolute; /* Positioning the button at the bottom */
            bottom: 15px;
            right: 15px;
            margin-bottom: 10px;
            margin-top: 5px;
        }
        .ad-button:hover {
            background-color: #45a049; /* Darker shade on hover */
        }
        /* Optional: Style for the loading spinner */
        .loading {
            display: none; /* Hidden by default */
            margin: 0 auto;
            text-align: center;
        }
    </style>

    <div id="loading" class="loading">Loading ads...</div> <!-- Loading spinner -->
    <div id="ads">


            <div class="ad-container" data-ad-id="{{ pair.ad.id }}">
                <img class="ad-image" src="{{ pair.ad.image.url }}" alt="{{ pair.ad.title }} Image">
                <h2 class="ad-title">{{ pair.ad.name }}</h2>
                <p class="ad-description">{{ pair.ad.description|truncatewords:3 }}</p>
                <p class="ad-date">Created on: {{ pair.ad.start_date|date:"F j, Y" }}</p>
                <a  href="https://wa.me/+263784777648?text=I'm interested in your product {{ pair.ad.name }} for sale on Maricho.com" > <button class="ad-button" onclick="handleAdClick({{ pair.ad.id }})">Click Here</button> </a>
            </div>

    </div>

{% endif %}
         {% endif %}
           {% endfor %}
            {% endfor %}

</div>
    </div>
         </div>

    <div class="right">
 <div class="ads">
                  {% for pair in post_ad_pairs %}
                  {% if pair.ad %}

            <div class="ad-container" data-ad-id="{{ pair.ad.id }}">
                <img class="ad-image" src="{{ pair.ad.image.url }}" alt="{{ pair.ad.title }} Image">
                <h2 class="ad-title">{{ pair.ad.name }}</h2>
                <p class="ad-description">{{ pair.ad.description|truncatewords:3 }}</p>
                <p class="ad-date">Created on: {{ pair.ad.start_date|date:"F j, Y" }}</p>
                <a  href="https://wa.me/+263784777648?text=I'm interested in your product {{ pair.ad.name }} for sale on Maricho.com" > <button class="ad-button" onclick="handleAdClick({{ pair.ad.id }})">Click Here</button> </a>
            </div>

           {% endif %}
           {% endfor %}

    </div>
    </div>
  <a href="https://wa.me/+263784777648?text=Hi%21%20I%20need%20assistance%20on%20Maricho.com" target="_blank" class="whatsapp-button">
      <img src="https://img.icons8.com/ios-filled/50/FFFFFF/whatsapp.png" alt="WhatsApp Icon"> </a>
</div>



<script>
    // Hamburger Menu
    function toggleMenu() {
        const menu = document.getElementById('menu');
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    // Open Fullscreen Story

    function openFullScreen(imageUrl) {
        const fullScreenStory = document.getElementById('full-screen-story');
        const fullStoryImage = document.getElementById('full-story-image');
        fullStoryImage.src = imageUrl;
        fullScreenStory.style.display = 'flex';
    }

    // Close Fullscreen Story
    function closeFullScreen() {
        const fullScreenStory = document.getElementById('full-screen-story');
        fullScreenStory.style.display = 'none';
    }
</script>

   <script>
$(document).ready(function() {
    $('.post').each(function() {
        const postID = $(this).data('post-id').split('-')[1];

        let commentsLoaded = false;  // Track whether comments have been loaded

        // Click event for the comment icon to toggle comments list and form
        $(`#toggle-comment-form-${postID}`).click(function() {
            $(`#comments-list-${postID}`).toggle();
            $(`#comment-form-${postID}`).toggle();

            // Load comments only if not already loaded
            if (!commentsLoaded) {
                loadComments(postID);
                commentsLoaded = true;
            }
        });

        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                 stars += i <= rating ? '<span class="star-rating">★</span>' : '<span class="star-rating">☆</span>';
            }
            return stars;
        }

        // Load comments function
        function loadComments(postID) {
            $.ajax({
                url: "{% url 'load_comment' 0 %}".replace('0', postID),  // dynamically insert postID
                method: 'GET',
                success: function(data) {
                    $(`#comments-list-${postID}`).empty();
                    data.comments.forEach(function(comment) {
                        $(`#comments-list-${postID}`).append(`
                            <div class="comment">
                                <p><strong>${comment.user}</strong> (${comment.created})</p>
                                <p>${comment.body}</p>
                                <p>Rating: ${generateStars(comment.rating)}</p>
                            </div>
                        `);
                    });
                }
            });
        }

        // Submit comment form
        $(`#comment-form-${postID}`).submit(function(e) {
            e.preventDefault();
            $.ajax({
                url: "{% url 'comment' 0 %}".replace('0', postID),  // dynamically insert postID
                method: 'POST',
                data: $(this).serialize(),
                success: function(data) {
                    $(`#comment-form-${postID}`).trigger("reset").hide();
                    commentsLoaded = false;  // Reset to allow reloading of comments
                    loadComments(postID);  // Reload comments for this post
                },
                error: function(response) {
                    alert("Error: " + response.responseJSON.error);
                }
            });
        });
    });
});


</script>


      <script>
        // Function to handle ad clicks
        function handleAdClick(adId) {
            // Simulate an ad click event (e.g., AJAX request to log click)
            console.log('Ad clicked:', adId);
            alert('Thank you for clicking on the ad!');

            // Redirect to the ad detail page or wherever needed
            window.location.href = `/ads/${adId}/detail/`;   // Update the URL as necessary
        }

        // Animate ads into view
        window.onload = function() {
            const ads = document.querySelectorAll('.ad-container');
            const loading = document.getElementById('loading');
            loading.style.display = 'none'; // Hide loading spinner after loading ads

            ads.forEach((ad, index) => {
                setTimeout(() => {
                    ad.classList.add('visible');
                }, index * 200); // Stagger the animations
            });
        };

        // Show loading spinner while ads are loading (optional)
        document.getElementById('loading').style.display = 'block';
    </script>

<script>
      $(document).ready(function () {
        $('.icon').click(function () {
            const icon = $(this);
            const postId = icon.data('post-id');
            const likeCountSpan = $(`#like-count-${postId}`);

            $.ajax({
                type: 'POST',
                url: '{% url "like-post" %}',  // Replace with your URL name for `like_post`
                data: {
                    'post_id': postId,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    // Update like count and toggle icon color based on response
                    likeCountSpan.text(response.likes);

                    if (response.liked) {
                        icon.addClass('liked');
                    } else {
                        icon.removeClass('liked');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        });
    });



let jobEl = document.getElementById('job');
let mainEl = document.getElementById('main');
let leftSb = document.getElementById('left-sb');
jobEl.addEventListener('click', loadJob)

function loadJob(){
jobEl.style.display = "grid"
leftSb.style.display = "grid"
mainEl.style.display = "none"
console.log('me')
};

let flwEl = document.getElementById('flw')
let flwsEl = document.getElementById('flws')

flwEl.addEventListener('click', loadFollowers)

function loadFollowers(){
flwsEl.style.display ="grid"
}
</script>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    const videoCards = document.querySelectorAll(".video-card");
    const modal = document.getElementById("video-modal");
    const videoContainer = document.getElementById("video-container");
    const closeModal = document.getElementById("close-modal");
    const scrollHint = document.getElementById("scroll-hint");
    const modalVideoIdInput = document.getElementById("modal-video-id");

    // Open modal and load video details
    videoCards.forEach(card => {
        card.addEventListener("click", function () {
            const videoId = this.getAttribute("data-video-id");
            if (!videoId) return;

            modalVideoIdInput.value = videoId; // Set video ID in hidden input

            fetch(`video/${videoId}/`)  // Assuming a backend URL to fetch video details
                .then(response => response.json())
                .then(data => {
                    // Create and load the video into the modal
                    const videoHTML = `
                        <div class="video-card" style="flex: 0 0 100%; scroll-snap-align: start; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                            <video controls loop autoplay muted style="width: 100%; height: 80%; object-fit: cover;">
                                <source src="${data.video_file_url}" type="video/mp4">
                            </video>
                            <div class="modal-icons" style="position: absolute; bottom: 20%; right: 10%; display: flex; flex-direction: column; gap: 10px; align-items: center;">
                                <i class="fa fa-heart" style="color: white; font-size: 24px; cursor: pointer;"></i>
                                <span>${data.likes}</span>
                                <i class="fa fa-comment" style="color: white; font-size: 24px; cursor: pointer;"></i>
                                <span>${data.comments_count}</span>
                            </div>
                        </div>
                        `;
                    videoContainer.innerHTML = videoHTML;

                    // Show modal
                    modal.style.display = "block";
                    scrollHint.style.display = "block";

                    // Hide scroll hint after 3 seconds
                    setTimeout(() => {
                        scrollHint.style.display = "none";
                    }, 3000);

                    // Fetch and display comments for the current video
                    fetchComments(videoId);
                })
                .catch(error => {
                    console.error("Error fetching video details:", error);
                });
        });
    });

    // Close modal
    closeModal.addEventListener("click", function () {
        modal.style.display = "none";
        videoContainer.innerHTML = ""; // Clear video content
    });

    // Fetch comments for the current video
    function fetchComments(videoId) {
        fetch(`video/${videoId}/comments/`)
            .then(response => response.json())
            .then(comments => {
                const commentsList = comments.map(comment => `
                    <p>
                        <strong>${comment.user__username}</strong>: ${comment.content}<br>
                        <small>${comment.created_at}</small>
                    </p>
                `).join('');
                document.getElementById("comments-list").innerHTML = commentsList;
            })
            .catch(error => console.error("Error fetching comments:", error));
    }

    // Handle comment submission
    const commentForm = document.getElementById("comment-form");
    commentForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const content = e.target.querySelector("textarea").value;
        const videoId = modalVideoIdInput.value;

        fetch(`video/${videoId}/comment/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ content }),
        })
            .then(response => response.json())
            .then(data => {
                const commentHTML = `
                    <p>
                        <strong>${data.user}</strong>: ${data.content}<br>
                        <small>${data.created_at}</small>
                    </p>`;
                document.getElementById("comments-list").innerHTML = commentHTML + document.getElementById("comments-list").innerHTML; // Prepend new comment
                e.target.querySelector("textarea").value = ""; // Clear input
            })
            .catch(error => console.error("Error posting comment:", error));
    });
});

</script>
</div>
</body>
</html>

